(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{319:function(s,e,n){s.exports=n.p+"assets/img/image-20230815163202787.c54d83d1.jpg"},320:function(s,e,n){s.exports=n.p+"assets/img/image-20230815163338444.d12a3237.jpg"},425:function(s,e,n){"use strict";n.r(e);var a=n(11),t=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"windbg访问硬件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#windbg访问硬件"}},[s._v("#")]),s._v(" WinDBG访问硬件")]),s._v(" "),e("p",[s._v("对于 X86 来说，访问硬件信息需要的基本操作有：")]),s._v(" "),e("ol",[e("li",[e("ol",[e("li",[s._v("PCI 信息的访问")]),s._v(" "),e("li",[s._v("访问IO Port 直接访问")]),s._v(" "),e("li",[s._v("IO Port Index/Data 方式的访问")]),s._v(" "),e("li",[s._v("Memory 的访问")]),s._v(" "),e("li",[s._v("Memory Index/Data 方式的访问")]),s._v(" "),e("li",[s._v("MSR 的访问")])])])]),s._v(" "),e("p",[s._v("掌握了上述的访问方法就可以访问到 X86 上的全部空间和寄存器。下面逐项介绍在 WinDBG 中的访问方法。因为大多数情况下，WinDBG 是用于调试 Windows 软件本身而不是硬件，因此很多操作都是来自个人总结如果有错误或者遗漏，恳请及时指出。")]),s._v(" "),e("h4",{attrs:{id:"_1-pci的访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-pci的访问"}},[s._v("#")]),s._v(" 1.PCI的访问")]),s._v(" "),e("p",[s._v("a. !pcitree 命令可以用来查看当前系统中的PCI总线和设备信息【参考1】")]),s._v(" "),e("p",[s._v("实例如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\n0: kd> !pcitree\nSYMSRV:  BYINDEX: 0x5\n         C:\\ProgramData\\Dbg\\sym\n         pci.pdb\n         96732E11A7284081C982C9A015D949A81\nSYMSRV:  UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb - path not found\nSYMSRV:  UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pd_ - path not found\nSYMSRV:  UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\file.ptr - path not found\nSYMSRV:  RESULT: 0x80070003\nSYMSRV:  BYINDEX: 0x6\n         C:\\ProgramData\\Dbg\\sym*https://msdl.microsoft.com/download/symbols\n         pci.pdb\n         96732E11A7284081C982C9A015D949A81\nSYMSRV:  UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb - path not found\nSYMSRV:  UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pd_ - path not found\nSYMSRV:  UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\file.ptr - path not found\nSYMSRV:  HTTPGET: /download/symbols/pci.pdb/96732E11A7284081C982C9A015D949A81/pci.pdb\nSYMSRV:  HttpQueryInfo: 801900c8 - HTTP_STATUS_OK\nSYMSRV:  pci.pdb from https://msdl.microsoft.com/download/symbols:copied      \nSYMSRV:  PATH: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb\nSYMSRV:  RESULT: 0x00000000\nDBGHELP: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb cached to C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb\nDBGHELP: pci - public symbols  \n        C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb\nBus 0x0 (FDO Ext ffffb106414d5a20)\n  (d=0,  f=0) 80863e34 devext 0xffffb1063bfef1b0 devstack 0xffffb1063bfef060 0600 Bridge/HOST to PCI\n  (d=2,  f=0) 80863ea0 devext 0xffffb1063bfee1b0 devstack 0xffffb1063bfee060 0300 Display Controller/VGA\n  (d=8,  f=0) 80861911 devext 0xffffb1063bfed1b0 devstack 0xffffb1063bfed060 0880 Base System Device/'Other' base system device\n  (d=12, f=0) 80869df9 devext 0xffffb1063bfec1b0 devstack 0xffffb1063bfec060 1180 Unknown Base Class/Unknown Sub Class\n  (d=13, f=0) 80869dfc devext 0xffffb1063bfeb1b0 devstack 0xffffb1063bfeb060 0700 Simple Serial Communications Controller/Serial Port\n  (d=14, f=0) 80869ded devext 0xffffb1063bfea1b0 devstack 0xffffb1063bfea060 0c03 Serial Bus Controller/USB\n  (d=14, f=2) 80869def devext 0xffffb1063bfe91b0 devstack 0xffffb1063bfe9060 0500 Memory Controller/RAM\n  (d=15, f=0) 80869de8 devext 0xffffb1063b4751b0 devstack 0xffffb1063b475060 0c80 Serial Bus Controller/Unknown Sub Class\n  (d=16, f=0) 80869de0 devext 0xffffb1063b4671b0 devstack 0xffffb1063b467060 0780 Simple Serial Communications Controller/'Other'\n  (d=1d, f=0) 80869db0 devext 0xffffb1063b4691b0 devstack 0xffffb1063b469060 0604 Bridge/PCI to PCI\n  Bus 0x1 (FDO Ext ffffb106414e1a20)\n    (d=0,  f=0) 144da802 devext 0xffffb106415d81b0 devstack 0xffffb106415d8060 0108 Mass Storage Controller/Unknown Sub Class\n  (d=1f, f=0) 80869d84 devext 0xffffb1063b47b740 devstack 0xffffb1063b47b5f0 0601 Bridge/PCI to ISA\n  (d=1f, f=3) 80869dc8 devext 0xffffb106414d01b0 devstack 0xffffb106414d0060 0401 Multimedia Device/Audio\n  (d=1f, f=4) 80869da3 devext 0xffffb106415c21b0 devstack 0xffffb106415c2060 0c05 Serial Bus Controller/Unknown Sub Class\n  (d=1f, f=5) 80869da4 devext 0xffffb106415c91b0 devstack 0xffffb106415c9060 0c80 Serial Bus Controller/Unknown Sub Class\nTotal PCI Root busses processed = 1\nTotal PCI Segments processed = 1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br")])]),e("p",[s._v("如果运行时出现类似下面的提示，需要使用.reload pci.sys 加载一下对应的 symbol")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !pcitree\nError retrieving address of PciFdoExtensionListHead\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("b. !pci 命令，参数比较多，这里直接给出常用的命令【参考2】")]),s._v(" "),e("p",[s._v("!pci 2 ff //列出当前系统中全部 PCI 设备")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !pci 2 ff  \nPCI Segment 0 Bus 0\n00:0  8086:3e34.0b  Cmd[0006:.mb...]  Sts[0090:c....]  Intel Host Bridge  SubID:8086:7270\n02:0  8086:3ea0.00  Cmd[0400:......]  Sts[0010:c....]  Intel VGA Compatible Controller  SubID:8086:2212\n08:0  8086:1911.00  Cmd[0000:......]  Sts[0010:c....]  Intel Other System Peripheral  SubID:8086:7270\n12:0  8086:9df9.30  Cmd[0002:.m....]  Sts[0010:c....]  Intel Other Signal Processing Controller  SubID:8086:7270\n13:0  8086:9dfc.30  Cmd[0000:......]  Sts[0010:c....]  Intel Serial Controller  SubID:8086:7270\n14:0  8086:9ded.30  Cmd[0406:.mb...]  Sts[0290:c....]  Intel Class:c:3:30  SubID:8086:7270\n14:2  8086:9def.30  Cmd[0006:.mb...]  Sts[0010:c....]  Intel RAM Controller\n15:0  8086:9de8.30  Cmd[0400:......]  Sts[0010:c....]  Intel Class:c:80:0  SubID:8086:7270\n16:0  8086:9de0.30  Cmd[0406:.mb...]  Sts[0010:c....]  Intel Other Communications Controller  SubID:8086:7270\n1d:0  8086:9db0.f0  Cmd[0407:imb...]  Sts[0010:c....]  Intel PCI-PCI Bridge 0->0x1-0x1\n1f:0  8086:9d84.30  Cmd[0407:imb...]  Sts[0000:.....]  Intel ISA Bridge  SubID:8086:7270\n1f:3  8086:9dc8.30  Cmd[0406:.mb...]  Sts[0010:c....]  Intel Audio Device  SubID:8086:7270\n1f:4  8086:9da3.30  Cmd[0000:......]  Sts[0280:.....]  Intel SMBus Controller  SubID:8086:7270\n1f:5  8086:9da4.30  Cmd[0402:.m....]  Sts[0000:.....]  Intel Class:c:80:0  SubID:8086:7270\nPCI Segment 0 Bus 0x1\n00:0  144d:a802.01  Cmd[0406:.mb...]  Sts[0010:c....]  Class:1:8:2  SubID:144d:a801\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("!pci f 0 2 0 0 0x200 //查看Bus 0, Device 2,function 0 上从 0 到 0x200的寄存器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !pci f 0 2 0 0 0x200\nPCI Segment 0 Bus 0\n02:0  8086:3ea0.00  Cmd[0400:......]  Sts[0010:c....]  Intel VGA Compatible Controller  SubID:8086:2212\n      cf8:80001000  IntPin:1  IntLine:0  Rom:0  cis:0  cap:40\n      MEM[0]:cf000004  MPF[2]:d000000c  IO[4]:ffc1       \n      00000000:  3ea08086 00100400 03000000 00000000\n      00000010:  cf000004 00000000 d000000c 00000000\n      00000020:  0000ffc1 00000000 00000000 22128086\n      00000030:  00000000 00000040 00000000 00000100\n      00000040:  010c7009 7a6160b1 9615808c 00000000\n      00000050:  000001c1 00008031 00000000 8e000001\n      00000060:  00010000 00000000 00000000 00000000\n      00000070:  0092ac10 10008000 00000000 00000000\n      00000080:  00000000 00000000 00000000 00000000\n      00000090:  00000000 00000000 00000000 00000000\n      000000a0:  00000000 00000000 00000000 0000d005\n      000000b0:  fee00358 00000000 00000000 00000000\n      000000c0:  00000000 00000000 00000000 00000000\n      000000d0:  00220001 00000003 00000000 00000000\n      000000e0:  00000000 00000000 00008000 00000000\n      000000f0:  00000000 00000000 00000000 8cb33018\n      00000100:  2001001b 00001400 00000000 00000000\n      00000110:  00000000 00000000 00000000 00000000\n      00000120:  00000000 00000000 00000000 00000000\n      00000130:  00000000 00000000 00000000 00000000\n      00000140:  00000000 00000000 00000000 00000000\n      00000150:  00000000 00000000 00000000 00000000\n      00000160:  00000000 00000000 00000000 00000000\n      00000170:  00000000 00000000 00000000 00000000\n      00000180:  00000000 00000000 00000000 00000000\n      00000190:  00000000 00000000 00000000 00000000\n      000001a0:  00000000 00000000 00000000 00000000\n      000001b0:  00000000 00000000 00000000 00000000\n      000001c0:  00000000 00000000 00000000 00000000\n      000001d0:  00000000 00000000 00000000 00000000\n      000001e0:  00000000 00000000 00000000 00000000\n      000001f0:  00000000 00000000 00000000 00000000\n      00000200:  0001000f\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br")])]),e("h4",{attrs:{id:"io-port-的访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#io-port-的访问"}},[s._v("#")]),s._v(" IO Port 的访问")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("Function")]),s._v(" "),e("th",[s._v("Command")]),s._v(" "),e("th",[s._v("Description / mnemonic")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("Read IO port")]),s._v(" "),e("td",[s._v("ib, iw, id")]),s._v(" "),e("td",[s._v("Input from port (byte, word, double word)")])]),s._v(" "),e("tr",[e("td",[s._v("Write IO port")]),s._v(" "),e("td",[s._v("ob, ow, od")]),s._v(" "),e("td",[s._v("Output to port (byte, word, double word)")])])])]),s._v(" "),e("h1",{attrs:{id:"硬件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#硬件"}},[s._v("#")]),s._v(" 硬件")]),s._v(" "),e("p",[s._v("前面对于 RU.EFI 的研究告诉我们对于 X86 来说，访问硬件信息需要的基本操作有：")]),s._v(" "),e("ol",[e("li",[s._v("PCI 信息的访问")]),s._v(" "),e("li",[s._v("访问IO Port 直接访问")]),s._v(" "),e("li",[s._v("IO Port Index/Data 方式的访问")]),s._v(" "),e("li",[s._v("Memory 的访问")]),s._v(" "),e("li",[s._v("Memory Index/Data 方式的访问")]),s._v(" "),e("li",[s._v("MSR 的访问")])]),s._v(" "),e("p",[s._v("掌握了上述的访问方法就可以访问到 X86 上的全部空间和寄存器。下面逐项介绍在 WinDBG 中的访问方法。因为大多数情况下，WinDBG 是用于调试 Windows 软件本身而不是硬件，因此很多操作都是来自个人总结如果有错误或者遗漏，恳请及时指出。")]),s._v(" "),e("p",[s._v("1.PCI的访问")]),s._v(" "),e("p",[s._v("a. !pcitree 命令可以用来查看当前系统中的PCI总线和设备信息【参考1】")]),s._v(" "),e("p",[s._v("实例如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !pcitree``SYMSRV: BYINDEX: 0x5``     ``C:\\ProgramData\\Dbg\\sym``     ``pci.pdb``     ``96732E11A7284081C982C9A015D949A81``SYMSRV: UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb - path not found``SYMSRV: UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pd_ - path not found``SYMSRV: UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\file.ptr - path not found``SYMSRV: RESULT: 0x80070003``SYMSRV: BYINDEX: 0x6``     ``C:\\ProgramData\\Dbg\\sym*https://msdl.microsoft.com/download/symbols``     ``pci.pdb``     ``96732E11A7284081C982C9A015D949A81``SYMSRV: UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb - path not found``SYMSRV: UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pd_ - path not found``SYMSRV: UNC: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\file.ptr - path not found``SYMSRV: HTTPGET: /download/symbols/pci.pdb/96732E11A7284081C982C9A015D949A81/pci.pdb``SYMSRV: HttpQueryInfo: 801900c8 - HTTP_STATUS_OK``SYMSRV: pci.pdb from https://msdl.microsoft.com/download/symbols:copied   ``SYMSRV: PATH: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb``SYMSRV: RESULT: 0x00000000``DBGHELP: C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb cached to C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb``DBGHELP: pci - public symbols ``    ``C:\\ProgramData\\Dbg\\sym\\pci.pdb\\96732E11A7284081C982C9A015D949A81\\pci.pdb``Bus 0x0 (FDO Ext ffffb106414d5a20)`` ``(d=0, f=0) 80863e34 devext 0xffffb1063bfef1b0 devstack 0xffffb1063bfef060 0600 Bridge/HOST to PCI`` ``(d=2, f=0) 80863ea0 devext 0xffffb1063bfee1b0 devstack 0xffffb1063bfee060 0300 Display Controller/VGA`` ``(d=8, f=0) 80861911 devext 0xffffb1063bfed1b0 devstack 0xffffb1063bfed060 0880 Base System Device/'Other' base system device`` ``(d=12, f=0) 80869df9 devext 0xffffb1063bfec1b0 devstack 0xffffb1063bfec060 1180 Unknown Base Class/Unknown Sub Class`` ``(d=13, f=0) 80869dfc devext 0xffffb1063bfeb1b0 devstack 0xffffb1063bfeb060 0700 Simple Serial Communications Controller/Serial Port`` ``(d=14, f=0) 80869ded devext 0xffffb1063bfea1b0 devstack 0xffffb1063bfea060 0c03 Serial Bus Controller/USB`` ``(d=14, f=2) 80869def devext 0xffffb1063bfe91b0 devstack 0xffffb1063bfe9060 0500 Memory Controller/RAM`` ``(d=15, f=0) 80869de8 devext 0xffffb1063b4751b0 devstack 0xffffb1063b475060 0c80 Serial Bus Controller/Unknown Sub Class`` ``(d=16, f=0) 80869de0 devext 0xffffb1063b4671b0 devstack 0xffffb1063b467060 0780 Simple Serial Communications Controller/'Other'`` ``(d=1d, f=0) 80869db0 devext 0xffffb1063b4691b0 devstack 0xffffb1063b469060 0604 Bridge/PCI to PCI`` ``Bus 0x1 (FDO Ext ffffb106414e1a20)``  ``(d=0, f=0) 144da802 devext 0xffffb106415d81b0 devstack 0xffffb106415d8060 0108 Mass Storage Controller/Unknown Sub Class`` ``(d=1f, f=0) 80869d84 devext 0xffffb1063b47b740 devstack 0xffffb1063b47b5f0 0601 Bridge/PCI to ISA`` ``(d=1f, f=3) 80869dc8 devext 0xffffb106414d01b0 devstack 0xffffb106414d0060 0401 Multimedia Device/Audio`` ``(d=1f, f=4) 80869da3 devext 0xffffb106415c21b0 devstack 0xffffb106415c2060 0c05 Serial Bus Controller/Unknown Sub Class`` ``(d=1f, f=5) 80869da4 devext 0xffffb106415c91b0 devstack 0xffffb106415c9060 0c80 Serial Bus Controller/Unknown Sub Class``Total PCI Root busses processed = 1``Total PCI Segments processed = 1\n如果运行时出现类似下面的提示，需要使用.reload pci.sys 加载一下对应的 symbol\n0: kd> !pcitree``Error retrieving address of PciFdoExtensionListHead\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("b. !pci 命令，参数比较多，这里直接给出常用的命令【参考2】")]),s._v(" "),e("p",[s._v("!pci 2 ff //列出当前系统中全部 PCI 设备")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !pci 2 ff ``PCI Segment 0 Bus 0``00:0 8086:3e34.0b Cmd[0006:.mb...] Sts[0090:c....] Intel Host Bridge SubID:8086:7270``02:0 8086:3ea0.00 Cmd[0400:......] Sts[0010:c....] Intel VGA Compatible Controller SubID:8086:2212``08:0 8086:1911.00 Cmd[0000:......] Sts[0010:c....] Intel Other System Peripheral SubID:8086:7270``12:0 8086:9df9.30 Cmd[0002:.m....] Sts[0010:c....] Intel Other Signal Processing Controller SubID:8086:7270``13:0 8086:9dfc.30 Cmd[0000:......] Sts[0010:c....] Intel Serial Controller SubID:8086:7270``14:0 8086:9ded.30 Cmd[0406:.mb...] Sts[0290:c....] Intel Class:c:3:30 SubID:8086:7270``14:2 8086:9def.30 Cmd[0006:.mb...] Sts[0010:c....] Intel RAM Controller``15:0 8086:9de8.30 Cmd[0400:......] Sts[0010:c....] Intel Class:c:80:0 SubID:8086:7270``16:0 8086:9de0.30 Cmd[0406:.mb...] Sts[0010:c....] Intel Other Communications Controller SubID:8086:7270``1d:0 8086:9db0.f0 Cmd[0407:imb...] Sts[0010:c....] Intel PCI-PCI Bridge 0->0x1-0x1``1f:0 8086:9d84.30 Cmd[0407:imb...] Sts[0000:.....] Intel ISA Bridge SubID:8086:7270``1f:3 8086:9dc8.30 Cmd[0406:.mb...] Sts[0010:c....] Intel Audio Device SubID:8086:7270``1f:4 8086:9da3.30 Cmd[0000:......] Sts[0280:.....] Intel SMBus Controller SubID:8086:7270``1f:5 8086:9da4.30 Cmd[0402:.m....] Sts[0000:.....] Intel Class:c:80:0 SubID:8086:7270``PCI Segment 0 Bus 0x1``00:0 144d:a802.01 Cmd[0406:.mb...] Sts[0010:c....] Class:1:8:2 SubID:144d:a801\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("!pci f 0 2 0 0 0x200 //查看Bus 0, Device 2,function 0 上从 0 到 0x200的寄存器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !pci f 0 2 0 0 0x200``PCI Segment 0 Bus 0``02:0 8086:3ea0.00 Cmd[0400:......] Sts[0010:c....] Intel VGA Compatible Controller SubID:8086:2212``   ``cf8:80001000 IntPin:1 IntLine:0 Rom:0 cis:0 cap:40``   ``MEM[0]:cf000004 MPF[2]:d000000c IO[4]:ffc1    ``   ``00000000: 3ea08086 00100400 03000000 00000000``   ``00000010: cf000004 00000000 d000000c 00000000``   ``00000020: 0000ffc1 00000000 00000000 22128086``   ``00000030: 00000000 00000040 00000000 00000100``   ``00000040: 010c7009 7a6160b1 9615808c 00000000``   ``00000050: 000001c1 00008031 00000000 8e000001``   ``00000060: 00010000 00000000 00000000 00000000``   ``00000070: 0092ac10 10008000 00000000 00000000``   ``00000080: 00000000 00000000 00000000 00000000``   ``00000090: 00000000 00000000 00000000 00000000``   ``000000a0: 00000000 00000000 00000000 0000d005``   ``000000b0: fee00358 00000000 00000000 00000000``   ``000000c0: 00000000 00000000 00000000 00000000``   ``000000d0: 00220001 00000003 00000000 00000000``   ``000000e0: 00000000 00000000 00008000 00000000``   ``000000f0: 00000000 00000000 00000000 8cb33018``   ``00000100: 2001001b 00001400 00000000 00000000``   ``00000110: 00000000 00000000 00000000 00000000``   ``00000120: 00000000 00000000 00000000 00000000``   ``00000130: 00000000 00000000 00000000 00000000``   ``00000140: 00000000 00000000 00000000 00000000``   ``00000150: 00000000 00000000 00000000 00000000``   ``00000160: 00000000 00000000 00000000 00000000``   ``00000170: 00000000 00000000 00000000 00000000``   ``00000180: 00000000 00000000 00000000 00000000``   ``00000190: 00000000 00000000 00000000 00000000``   ``000001a0: 00000000 00000000 00000000 00000000``   ``000001b0: 00000000 00000000 00000000 00000000``   ``000001c0: 00000000 00000000 00000000 00000000``   ``000001d0: 00000000 00000000 00000000 00000000``   ``000001e0: 00000000 00000000 00000000 00000000``   ``000001f0: 00000000 00000000 00000000 00000000``   ``00000200: 0001000f\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("IO Port 的访问")])]),s._v(" "),e("p",[e("strong",[s._v("IO port to read")]),s._v(" and write【参考3】")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("Function")]),s._v(" "),e("th",[s._v("Command")]),s._v(" "),e("th",[s._v("Description / mnemonic")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("Read IO port")]),s._v(" "),e("td",[s._v("ib, iw, id")]),s._v(" "),e("td",[s._v("Input from port (byte, word, double word)")])]),s._v(" "),e("tr",[e("td",[s._v("Write IO port")]),s._v(" "),e("td",[s._v("ob, ow, od")]),s._v(" "),e("td",[s._v("Output to port (byte, word, double word)")])])])]),s._v(" "),e("p",[s._v("实例如下 ：访问70/71 上面的 CMOS，这个位置是当前的Second 所以过了一段时间会有变化")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !ob 70 0\n0: kd> !ib 71\n00000071: 000000000059\n0: kd> !ob 70 0\n0: kd> !ib 71\n00000071: 000000000004\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h4",{attrs:{id:"memory-的访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#memory-的访问"}},[s._v("#")]),s._v(" Memory 的访问")]),s._v(" "),e("p",[s._v("对于我们来说关注点通常只是物理内存，可以通过 !d* 命令来访问到【参考1】")]),s._v(" "),e("p",[s._v("实例如下 ：!db 0xFFFFFF00 l 0x100  //按照Byte访问0xFFFFFF00,长度为 0x100 字节")]),s._v(" "),e("img",{staticStyle:{width:"100%"},attrs:{src:n(319)}}),s._v(" "),e("p",[s._v("目标机上同时使用 RW Everything 查看,可以看到结果相同：")]),s._v(" "),e("img",{staticStyle:{width:"100%"},attrs:{src:n(320)}}),s._v(" "),e("h4",{attrs:{id:"msr-的访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#msr-的访问"}},[s._v("#")]),s._v(" .MSR 的访问")]),s._v(" "),e("p",[s._v("可以通过 rdmsr 和  wrmsr 来实现，例如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> rdmsr 0x2ff\nmsr[2ff] = 00000000`00000c06\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("此外，CPUID也可以被看作是一种MSR 可以用 CPUID 指令进行访问【参考4】：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("0: kd> !cpuid\nCP  F/M/S  Manufacturer     MHz\n 0  6,142,11 GenuineIntel    1992\n 1  6,142,11 GenuineIntel    1992\n 2  6,142,11 GenuineIntel    1992\n 3  6,142,11 GenuineIntel    1992\n 4  6,142,11 GenuineIntel    1992\n 5  6,142,11 GenuineIntel    1992\n 6  6,142,11 GenuineIntel    1992\n 7  6,142,11 GenuineIntel    1992\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("不过看起来能够提供的信息还是比较有限的。")]),s._v(" "),e("p",[e("strong",[s._v("参考：")])]),s._v(" "),e("ol",[e("li",[s._v("https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-pcitree")]),s._v(" "),e("li",[s._v("https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-pci")]),s._v(" "),e("li",[s._v("https://www.cnblogs.com/jiangxueqiao/p/7418195.html")]),s._v(" "),e("li",[s._v("https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-cpuid")])])])}),[],!1,null,null,null);e.default=t.exports}}]);